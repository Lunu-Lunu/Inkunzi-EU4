on_startup = {
	initialize_race_estates = yes
	karpunian_canals_prov_group = {
		add_province_triggered_modifier = karpunian_canals_tier_0_triggered_modifier
		add_province_triggered_modifier = karpunian_canals_tier_1_triggered_modifier
		add_province_triggered_modifier = karpunian_canals_tier_2_triggered_modifier
		add_province_triggered_modifier = karpunian_canals_tier_3_triggered_modifier
	}
}
on_culture_promoted = {
	promoted_races_recalc = yes
}
on_culture_demoted = {
	promoted_races_recalc = yes
}
on_primary_culture_changed = {
	primary_race_recalc = yes
}
on_monarch_death = {
	events = {
		ervaric_events.1
		alzhaic_events.1
	}
}
on_new_monarch = {
	events = {
		bytosdeath.1
	}
}

on_province_culture_converted = {
	different_race_culture_conversion_effect = yes
	owner = {
		create_autonomous_areas = yes
		remove_autonomous_areas = yes
	}
}

# province
# FROM = old owner
on_province_owner_change = {
	if = {
		limit = {
			has_colonist = yes
		}
		clr_province_flag = human_province
		clr_province_flag = ourk_province
		clr_province_flag = nimbus_province
		clr_province_flag = frog_province
		clr_province_flag = rat_province
		clr_province_flag = goat_province
		clr_province_flag = hesh_province
		clr_province_flag = ape_province
		clr_province_flag = ent_province
		clr_province_flag = dwarf_province
		clr_province_flag = centaur_province
		clr_province_flag = crab_province
		clr_province_flag = draconic_province
		clr_province_flag = mushroom_province
		clr_province_flag = golem_province
		clr_province_flag = elf_province
		clr_province_flag = sia_si_province
		clr_province_flag = gneta_province
		clr_province_flag = furry_province
		clr_province_flag = lizard_province
		clr_province_flag = goblin_province
		clr_province_flag = moth_province
		clr_province_flag = snake_province
		province_event = { id = workaround.2 days = 1 }
	}
	owner = {
		create_autonomous_areas = yes
		remove_autonomous_areas = yes
	}

	if = {
		limit = {
			owner = {
				tag = B06
				mission_completed = ionidius_mission_necessity_of_kinslaying
			}
			culture = ourkani
		}
		add_nationalism = -10
	}
	
	if = {
		limit = {
			OR = {
				has_province_modifier = wine_bonus_prod
				has_province_modifier = grain_bonus_prod
			}
			FROM = { has_reform = monastic_breweries_reform }
			NOT = { owner = { has_reform = monastic_breweries_reform } }
		}
		remove_province_modifier = wine_bonus_prod
		remove_province_modifier = grain_bonus_prod
	}
	
	if = {
		limit = {
			NOT = {
				OR = {
					has_province_modifier = wine_bonus_prod
					has_province_modifier = grain_bonus_prod
				}
			}
			owner = { has_reform = monastic_breweries_reform }
			NOT = { FROM = { has_reform = monastic_breweries_reform } }
		}
		hidden_effect = {
			if = {
				limit = {
					trade_goods = wine
				}
				add_province_modifier = { 
					name = wine_bonus_prod
					duration = -1
					hidden = yes
				}
			}
			if = {
				limit = {
					trade_goods = grain
				}
				add_province_modifier = { 
					name = grain_bonus_prod
					duration = -1
					hidden = yes
				}
			}
		}
	}

	if = {
		limit = {
			owned_by = SRU
			exists = ARA
		}
		ARA = {
			set_country_flag = ARA_defeat_saruhan
		}
	}
	if = {
		limit = {
			NOT = { owner = { religion_group = muslim } }
			has_province_modifier = sufi_shrine
		}
		remove_province_modifier = sufi_shrine
	}
	on_province_owner_change_estate_privileges_effect = yes
	
	if = {
		limit = {
			region = france_region
			has_building = farm_estate
			trade_goods = grain
			owner = {
				has_mission = mnd_khm_irrigation 
				NOT = {
					OR = {
						has_estate = estate_vaisyas
						has_estate = estate_burghers
					}
				}
			}
		}
		add_province_modifier = {
			name = grain_production_improved
			duration = 7300
		}
	}
}
